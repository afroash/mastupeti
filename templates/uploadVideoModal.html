<!-- The Upload Video Modal -->
<div id="modal" _="on closeModal add .closing then wait for animationend then remove me">
    <div class="modal-underlay" _="on click trigger closeModal"></div>
    <div class="modal-content">
        <p>Upload your video here...</p>
        <form id="upload-form" hx-post="/videos" hx-encoding="multipart/form-data" hx-indicator="#progress-container" hx-target="#result" class="box">
            <div class="field">
                <label class="label">Title</label>
                <div class="control">
                    <input class="input" type="text" name="title" required>
                </div>
            </div>
            <div class="field">
                <label class="label">Description</label>
                <div class="control">
                    <textarea class="textarea" name="description" required></textarea>
                </div>
            </div>
            <div class="field">
                <label class="label">Video File</label>
                <div class="control">
                    <input class="input" type="file" name="file" accept="video/*" required>
                </div>
            </div>
            <div class="field">
                <div class="control">
                    <button class="button is-primary" type="submit">Upload</button>
                </div>
            </div>
            <div id="progress-container" class="field">
                <progress id="progress" value="0" max="100" style="width: 100%; display: none;"></progress>
            </div>
        </form>
        <div id="result"></div>
    </div>
</div>
<script>
    htmx.on("#upload-form", "htmx:xhr:progress", function(evt) {
        var progress = evt.detail.loaded / evt.detail.total * 100;
        var progressBar = document.getElementById("progress");
        progressBar.style.display = "block";
        progressBar.value = progress;
    });

    htmx.on("#upload-form", "htmx:afterRequest", function(evt) {
        var response = JSON.parse(evt.detail.xhr.responseText);
        if (response.redirect) {
            window.location.href = response.redirect;
        }
    });
</script>
